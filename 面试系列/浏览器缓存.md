+ 缓存的位置

  1. menory cache 存在内存中

  2. disk cache存在磁盘中

  3. `Service Worker` 是运行在浏览器背后的独立线程，一般可以用来实现缓存功能。

     注意点：

     1. 必须是 `HTTPS`。因为它涉及请求拦截，所以必须使用 `HTTPS` 协议来保障安全。
     2. `Service Worker` 缓存不同于其他机制，它可以让我们自由控制缓存哪些文件、如何匹配缓存、如何读取缓存，并且缓存是持续性的。

  4. `Push Cache`（推送缓存） 是 `HTTP/2` 中的内容，当以上 3 种缓存都没有命中的时候，它才会被使用。

     注意点：

     1. 它只在会话（`Session`）中存在，一旦会话结束就被释放，并且缓存也很短暂。

+ 过程

  1. **浏览器** 发起一次 HTTP 请求
  2. **浏览器缓存** 告诉浏览器这边没有该请求的缓存结果和缓存标识
  3. **浏览器** 向 **服务器** 发起 `HTTP` 请求
  4. **服务器** 返回该请求结果和缓存规则
  5. **浏览器** 将该请求结果和缓存标识存入浏览器缓存中

+ 机制

  缓存分为 **强缓存** 和 **协商缓存**。

  强缓存优先于协商缓存进行，若强制缓存生效则直接使用缓存，若不生效则进行协商缓存。

  协商缓存由服务器决定是否使用缓存，若协商缓存失效，那么该请求的缓存失效，返回 `200`，重新返回资源和缓存标识，再存入浏览器中；生效则返回 `304`，继续使用缓存。

  如果强缓存和协商缓存都没有设置，那么浏览器会采用启发式的算法，通常会取响应头中的 `Date` 减去 `Last-Modified` 的值的 `10%` 作为缓存时间。

  - 强缓存实现方式：

  1. `Expires`   表示缓存失效的时间，由响应头携带
  2. `Cache-Control`  常用值为 `max-age=31536000 `  表示缓存生效的时间为一年（最长） 由响应头携带

  - **两者对比**：

  `Expires` 是 `HTTP/1.0` 的产物，`Cache-Control` 是 `HTTP/1.1` 的产物。两者同时存在的时候，`Cache-Control` 优先级高于 `Expires`。

  + 协商缓存

    1.  last-modify 表示上次更改的时间  第一次请求时，响应头带回，然后请求该资源时，会带上**if-modify-since**，值为之前的last-modify，去询问服务器是否有改动，如果没有改动，命中协商缓存，返回304，如果有改动，会返回新的last-modify 和资源

    2.  Etag 相当于是否变动的标记 第一次请求时，响应头带回，然后请求该资源时，会带上**If-None-Match**，也就是

        也就是Etag的值 ，如果没有改动，命中协商缓存，返回304，和last-modify 区别是 还是会返回旧的Etag ，同理：如果有改动，会返回新的Etag 和资源

  + 比较：1. Etag优先级高，Etag一致的话，再去验证last-modify，2.  last-modify的缺点是：周期性改动不好识别，超短时间的改动不变化值

  ​

### 总结

当浏览器再次访问一个已经访问过的资源时，它会这样做：

1.看看是否命中强缓存，如果命中，就直接使用缓存了。

2.如果没有命中强缓存，就发请求到服务器检查是否命中协商缓存。

3.如果命中协商缓存，服务器会返回 304 告诉浏览器使用本地缓存。

4.否则，返回最新的资源。